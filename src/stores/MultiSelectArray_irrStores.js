// 导入文字图片
const move_omens = new URL('/src/assets/image/img/font_blue/recent_luck/搬迁事情的吉凶预兆.png', import.meta.url).href;
const fortune = new URL('/src/assets/image/img/font_blue/recent_luck/财运如何.png', import.meta.url).href;
const work_promotion = new URL('/src/assets/image/img/font_blue/recent_luck/工作官运.png', import.meta.url).href;
const company_development = new URL('/src/assets/image/img/font_blue/recent_luck/公司发展.png', import.meta.url).href;
const investment = new URL('/src/assets/image/img/font_blue/recent_luck/投资.png', import.meta.url).href;
const emotional_experience_marriage = new URL('/src/assets/image/img/font_blue/recent_luck/情感体验和婚姻婚外情.png', import.meta.url).href;
const interpersonal_relationships = new URL('/src/assets/image/img/font_blue/recent_luck/人际关系.png', import.meta.url).href;
const who_can_help = new URL('/src/assets/image/img/font_blue/recent_luck/谁能帮你解决问题.png', import.meta.url).href;
const seeking_assistance = new URL('/src/assets/image/img/font_blue/recent_luck/求人办事.png', import.meta.url).href;
const bearing_children = new URL('/src/assets/image/img/font_blue/recent_luck/生育子女.png', import.meta.url).href;
const physical_mental_health = new URL('/src/assets/image/img/font_blue/recent_luck/身心健康.png', import.meta.url).href;
const medical_treatment = new URL('/src/assets/image/img/font_blue/recent_luck/伤病治疗.png', import.meta.url).href;
const marriage = new URL('/src/assets/image/img/font_blue/recent_luck/嫁娶.png', import.meta.url).href;
const official_disputes = new URL('/src/assets/image/img/font_blue/recent_luck/官灾是非.png', import.meta.url).href;
const learning_exams = new URL('/src/assets/image/img/font_blue/recent_luck/学习考试过关.png', import.meta.url).href;
const travel = new URL('/src/assets/image/img/font_blue/recent_luck/旅游出行.png', import.meta.url).href;
const vehicle_use = new URL('/src/assets/image/img/font_blue/recent_luck/车辆使用.png', import.meta.url).href;
const buying_renting_houses = new URL('/src/assets/image/img/font_blue/recent_luck/买卖房屋.png', import.meta.url).href;
const ancestral_grave_relocation = new URL('/src/assets/image/img/font_blue/recent_luck/迁移祖先坟墓.png', import.meta.url).href;
const feng_shui_changes = new URL('/src/assets/image/img/font_blue/recent_luck/风水变化.png', import.meta.url).href;
const lost_items = new URL('/src/assets/image/img/font_blue/recent_luck/失物找寻.png', import.meta.url).href;
const tattoos_scars = new URL('/src/assets/image/img/font_blue/recent_luck/纹身（伤疤）.png', import.meta.url).href;
const making_new_friends_contacting_old_friends = new URL('/src/assets/image/img/font_blue/recent_luck/结交新友联络旧友.png', import.meta.url).href;
const helping_others = new URL('/src/assets/image/img/font_blue/recent_luck/帮助他人.png', import.meta.url).href;
const unfair_improper_actions = new URL('/src/assets/image/img/font_blue/recent_luck/做了不公平不正当甚至是害人的事情.png', import.meta.url).href;
const resignation = new URL('/src/assets/image/img/font_blue/recent_luck/辞职.png', import.meta.url).href;
const skill_enhancement = new URL('/src/assets/image/img/font_blue/recent_luck/技能修养提升.png', import.meta.url).href;
const living_with_others = new URL('/src/assets/image/img/font_blue/recent_luck/与人同室居住.png', import.meta.url).href;
const family_member_passing = new URL('/src/assets/image/img/font_blue/recent_luck/亲人去世.png', import.meta.url).href;
const harming_animals = new URL('/src/assets/image/img/font_blue/recent_luck/杀害伤害动物.png', import.meta.url).href;
const loss_damage_of_items = new URL('/src/assets/image/img/font_blue/recent_luck/物品的丢失损毁.png', import.meta.url).href;
const adopting_abandoning_animals = new URL('/src/assets/image/img/font_blue/recent_luck/收养（或弃养）动物.png', import.meta.url).href;
const losing_people_pets = new URL('/src/assets/image/img/font_blue/recent_luck/人和动物与你走失.png', import.meta.url).href;
const weather_impact_on_major_events = new URL('/src/assets/image/img/font_blue/recent_luck/做大事时的天气影响.png', import.meta.url).href;


const move_omens_white = new URL('/src/assets/image/img/font_white/recent_luck/搬迁事情的吉凶预兆.png', import.meta.url).href;
const fortune_white = new URL('/src/assets/image/img/font_white/recent_luck/财运如何.png', import.meta.url).href;
const work_promotion_white = new URL('/src/assets/image/img/font_white/recent_luck/工作官运.png', import.meta.url).href;
const company_development_white = new URL('/src/assets/image/img/font_white/recent_luck/公司发展.png', import.meta.url).href;
const investment_white = new URL('/src/assets/image/img/font_white/recent_luck/投资.png', import.meta.url).href;
const emotional_experience_marriage_white = new URL('/src/assets/image/img/font_white/recent_luck/情感体验和婚姻婚外情.png', import.meta.url).href;
const interpersonal_relationships_white = new URL('/src/assets/image/img/font_white/recent_luck/人际关系.png', import.meta.url).href;
const who_can_help_white = new URL('/src/assets/image/img/font_white/recent_luck/谁能帮你解决问题.png', import.meta.url).href;
const seeking_assistance_white = new URL('/src/assets/image/img/font_white/recent_luck/求人办事.png', import.meta.url).href;
const bearing_children_white = new URL('/src/assets/image/img/font_white/recent_luck/生育子女.png', import.meta.url).href;
const physical_mental_health_white = new URL('/src/assets/image/img/font_white/recent_luck/身心健康.png', import.meta.url).href;
const medical_treatment_white = new URL('/src/assets/image/img/font_white/recent_luck/伤病治疗.png', import.meta.url).href;
const marriage_white = new URL('/src/assets/image/img/font_white/recent_luck/嫁娶.png', import.meta.url).href;
const official_disputes_white = new URL('/src/assets/image/img/font_white/recent_luck/官灾是非.png', import.meta.url).href;
const learning_exams_white = new URL('/src/assets/image/img/font_white/recent_luck/学习考试过关.png', import.meta.url).href;
const travel_white = new URL('/src/assets/image/img/font_white/recent_luck/旅游出行.png', import.meta.url).href;
const vehicle_use_white = new URL('/src/assets/image/img/font_white/recent_luck/车辆使用.png', import.meta.url).href;
const buying_renting_houses_white = new URL('/src/assets/image/img/font_white/recent_luck/买卖房屋.png', import.meta.url).href;
const ancestral_grave_relocation_white = new URL('/src/assets/image/img/font_white/recent_luck/迁移祖先坟墓.png', import.meta.url).href;
const feng_shui_changes_white = new URL('/src/assets/image/img/font_white/recent_luck/风水变化.png', import.meta.url).href;
const lost_items_white = new URL('/src/assets/image/img/font_white/recent_luck/失物找寻.png', import.meta.url).href;
const tattoos_scars_white = new URL('/src/assets/image/img/font_white/recent_luck/纹身（伤疤）.png', import.meta.url).href;
const making_new_friends_contacting_old_friends_white = new URL('/src/assets/image/img/font_white/recent_luck/结交新友联络旧友.png', import.meta.url).href;
const helping_others_white = new URL('/src/assets/image/img/font_white/recent_luck/帮助他人.png', import.meta.url).href;
const unfair_improper_actions_white = new URL('/src/assets/image/img/font_white/recent_luck/做了不公平不正当甚至是害人的事情.png', import.meta.url).href;
const resignation_white = new URL('/src/assets/image/img/font_white/recent_luck/辞职.png', import.meta.url).href;
const skill_enhancement_white = new URL('/src/assets/image/img/font_white/recent_luck/技能修养提升.png', import.meta.url).href;
const living_with_others_white = new URL('/src/assets/image/img/font_white/recent_luck/与人同室居住.png', import.meta.url).href;
const family_member_passing_white = new URL('/src/assets/image/img/font_white/recent_luck/亲人去世.png', import.meta.url).href;
const harming_animals_white = new URL('/src/assets/image/img/font_white/recent_luck/杀害伤害动物.png', import.meta.url).href;
const loss_damage_of_items_white = new URL('/src/assets/image/img/font_white/recent_luck/物品的丢失损毁.png', import.meta.url).href;
const adopting_abandoning_animals_white = new URL('/src/assets/image/img/font_white/recent_luck/收养（或弃养）动物.png', import.meta.url).href;
const losing_people_pets_white = new URL('/src/assets/image/img/font_white/recent_luck/人和动物与你走失.png', import.meta.url).href;
const weather_impact_on_major_events_white = new URL('/src/assets/image/img/font_white/recent_luck/做大事时的天气影响.png', import.meta.url).href;

// 导入图标（选中、未选中）
const unChooseIcon = new URL('/src/assets/image/img/未选.png', import.meta.url).href; // 未选图标
const hvChooseIcon = new URL('/src/assets/image/img/已选.png', import.meta.url).href; // 已选图标

// 定义背景颜色（选中、未选中）
const bgColor = {
  hvBgColor: '#00d0d4', // 已选背景颜色 
  unBgColor: '#e3fdfe', // 未选背景颜色
} 

// 导入库
import { defineStore } from 'pinia';
import { ref, onUnmounted} from 'vue';


export const useSelected_irrStore = defineStore('selected_irr', () => {

        // 黑字图片（未选中）
        const imgUrlArray = ref([]);
        // 备份 黑字图片（未选中） 
        const imgUrlArray_backup = ref([]); 
        // 白字图片（选中）
        const imgUrlArray_white = ref([]);


        // 保存 选项 是否被选中的
        const chooseIcon = ref(imgUrlArray.value.map(() => unChooseIcon)); //  图标
        const bgColorItem = ref(imgUrlArray.value.map(() => bgColor.unBgColor)); // 背景颜色

        // 页数
        const pageNum = ref();

        // 把选项状态切换成未选中的方法
        function resetChooseIcon(index) {
            // 背景颜色切换
            bgColorItem.value[index] = bgColorItem.value[index] === bgColor.hvBgColor ? bgColor.unBgColor : bgColor.hvBgColor;
            // 图标切换
            chooseIcon.value[index] = chooseIcon.value[index] === unChooseIcon ? hvChooseIcon : unChooseIcon;
            if(pageNum.value === 5) {
                // 文字图片切换
                imgUrlArray.value[index] = imgUrlArray.value[index] === imgUrlArray_white.value[index] ? imgUrlArray_backup.value[index] : imgUrlArray_white.value[index];
            } else if (pageNum.value === 6) {
                // 文字图片切换
                paths.value[index] = paths.value[index] === paths_white.value[index] ? paths_backup.value[index] : paths_white.value[index];
            }
            // console.log('颜色：', decodeURI(bgColorItem.value[index]))
            // console.log('图标：', decodeURI(chooseIcon.value[index]))
            // console.log('图片：', decodeURI(imgUrlArray.value[index]))
        }

        // 未选中
        function to_blue(index) {
            console.log('所有选项状态设置为未选中')
            // 背景颜色切换
            bgColorItem.value[index] = bgColor.unBgColor
            // 图标切换
            chooseIcon.value[index] = unChooseIcon;
            // 文字图片切换
            if(pageNum.value === 5) {
                imgUrlArray.value[index] = imgUrlArray_backup.value[index]
            } else if (pageNum.value === 6) {
                paths.value[index] = paths_backup.value[index]
            }
        }
        // 选中
        function to_white(index) {
            // 背景颜色切换
            bgColorItem.value[index] = bgColor.hvBgColor
            // 图标切换
            chooseIcon.value[index] = hvChooseIcon;
            // 文字图片切换
            if(pageNum.value === 5) {
                imgUrlArray.value[index] = imgUrlArray_white.value[index]
            } else if (pageNum.value === 6) {
                paths.value[index] = paths_white.value[index]
            }
        }
        

        // 中文名和编号的映射处理
        function idcnMapHandler(cnString) {
            const map = {
                '财运如何': '1',
                '工作官运': '2',
                '公司发展': '3',
                '投资': '4',
                '情感体验和婚姻婚外情': '5',
                '人际关系': '6',
                '谁能帮你解决问题': '7',
                '求人办事': '8',
                '生育子女': '9',
                '身心健康': '10',
                '伤病治疗': '11',
                '嫁娶': '12',
                '官灾是非': '13',
                '学习考试过关': '14',
                '旅游出行': '15',
                '车辆使用': '16',
                '买卖房屋': '17',
                '迁移祖先坟墓': '18',
                '风水变化': '19',
                '搬迁事情的吉凶预兆': '20',
                '失物找寻': '21',
                '纹身（伤疤）': '22',
                '结交新友联络旧友': '23',
                '帮助他人': '24',
                '做了不公平不正当甚至是害人的事情': '25',
                '辞职': '26',
                '技能修养提升': '27',
                '与人同室居住': '28',
                '亲人去世': '29',
                '杀害伤害动物': '30',
                '物品的丢失损毁': '31',
                '收养（或弃养）动物': '32',
                '人和动物与你走失': '33',
                '做大事时的天气影响': '34'
            };
            return map[cnString] || null; // 或者 throw new Error("Invalid input");
        }

        // 保存选中的选项的编号
        const ids = ref([]);

        // 保存选中的选项的名字
        const names = ref([]);

        // 保存选中的选项的路径（luck-analysis-6.vue）
        const paths = ref([]);
        const paths_backup = ref([]);
        const paths_white = ref([]);

        // 最后被选元素的索引（主要用于关闭数选框时恢复为未选中样式）
        const lastSelectedIndex = ref(-1);

        // 获取选中后的选项路径
        function getSelectedPaths() {
            paths.value = names.value.map((name) => {
                return "/src/assets/image/img/font_blue/recent_luck/" + name + ".png"
            })
            
            paths_backup.value = names.value.map((name) => {
                return "/src/assets/image/img/font_blue/recent_luck/" + name + ".png" 
            })

            paths_white.value = names.value.map((name) => {
                return "/src/assets/image/img/font_white/recent_luck/" + name + ".png"   
            })
            console.log('初始化完毕')
            console.log( paths.value)
        }


    // 根据屏幕尺寸动态设置 Dropdown组件的宽度和高度、page-1的决定子类排列方向的类
    const resizeSetter = () => {



      const innerWidth = window.innerWidth;

      if (innerWidth < 992) { // 移动端767.98
        // 黑字图片（未选中）
        imgUrlArray.value = [
            fortune,
            work_promotion,
            company_development,
            investment,
            interpersonal_relationships,
            helping_others,
            emotional_experience_marriage,
            who_can_help,
            seeking_assistance,
            bearing_children,
            physical_mental_health,
            medical_treatment,
            marriage,
            official_disputes,
            learning_exams,
            travel,
            vehicle_use,
            buying_renting_houses,
            ancestral_grave_relocation,
            feng_shui_changes,
            move_omens,
            lost_items,
            tattoos_scars,
            
            making_new_friends_contacting_old_friends,
            unfair_improper_actions,
            skill_enhancement,
            living_with_others,
            family_member_passing,
            resignation,

            adopting_abandoning_animals,
            losing_people_pets,
            weather_impact_on_major_events,
            harming_animals,
            loss_damage_of_items,
        ];
        // 备份 黑字图片（未选中） 
        imgUrlArray_backup.value = [
            fortune,
            work_promotion,
            company_development,
            investment,
            interpersonal_relationships,
            helping_others,
            emotional_experience_marriage,
            who_can_help,
            seeking_assistance,
            bearing_children,
            physical_mental_health,
            medical_treatment,
            marriage,
            official_disputes,
            learning_exams,
            travel,
            vehicle_use,
            buying_renting_houses,
            ancestral_grave_relocation,
            feng_shui_changes,
            move_omens,
            lost_items,
            tattoos_scars,
            
            making_new_friends_contacting_old_friends,
            unfair_improper_actions,
            skill_enhancement,
            living_with_others,
            family_member_passing,
            resignation,

            adopting_abandoning_animals,
            losing_people_pets,
            weather_impact_on_major_events,
            harming_animals,
            loss_damage_of_items,
        ]; 
        // 白字图片（选中）
        imgUrlArray_white.value = [
            fortune_white,
            work_promotion_white,
            company_development_white,
            investment_white,
            interpersonal_relationships_white,
            helping_others_white,
            emotional_experience_marriage_white,
            who_can_help_white,
            seeking_assistance_white,
            bearing_children_white,
            physical_mental_health_white,
            medical_treatment_white,
            marriage_white,
            official_disputes_white,
            learning_exams_white,
            travel_white,
            vehicle_use_white,
            buying_renting_houses_white,
            ancestral_grave_relocation_white,
            feng_shui_changes_white,
            move_omens_white,
            lost_items_white,
            tattoos_scars_white,
            
            making_new_friends_contacting_old_friends_white,
            unfair_improper_actions_white,
            skill_enhancement_white,
            living_with_others_white,
            family_member_passing_white,
            resignation_white,
            
            adopting_abandoning_animals_white,
            losing_people_pets_white,
            weather_impact_on_major_events_white,
            harming_animals_white,
            loss_damage_of_items_white,
        ];

      } else if (innerWidth >= 992) {
            // 黑字图片（未选中）
            imgUrlArray.value = [
                fortune,
                work_promotion,
                company_development,
                investment,
                interpersonal_relationships,
                helping_others,
                emotional_experience_marriage,
                who_can_help,
                seeking_assistance,
                bearing_children,
                physical_mental_health,
                medical_treatment,
                marriage,
                official_disputes,
                learning_exams,
                travel,
                vehicle_use,
                buying_renting_houses,
                ancestral_grave_relocation,
                feng_shui_changes,
                move_omens,
                lost_items,
                tattoos_scars,
                resignation,

                making_new_friends_contacting_old_friends,
                unfair_improper_actions,
                skill_enhancement,
                living_with_others,
                family_member_passing,
                adopting_abandoning_animals,
                losing_people_pets,
                weather_impact_on_major_events,
                harming_animals,
                loss_damage_of_items,
            ];
            // 备份 黑字图片（未选中） 
            imgUrlArray_backup.value = [
                fortune,
                work_promotion,
                company_development,
                investment,
                interpersonal_relationships,
                helping_others,
                emotional_experience_marriage,
                who_can_help,
                seeking_assistance,
                bearing_children,
                physical_mental_health,
                medical_treatment,
                marriage,
                official_disputes,
                learning_exams,
                travel,
                vehicle_use,
                buying_renting_houses,
                ancestral_grave_relocation,
                feng_shui_changes,
                move_omens,
                lost_items,
                tattoos_scars,
                resignation,

                making_new_friends_contacting_old_friends,
                unfair_improper_actions,
                skill_enhancement,
                living_with_others,
                family_member_passing,
                adopting_abandoning_animals,
                losing_people_pets,
                weather_impact_on_major_events,
                harming_animals,
                loss_damage_of_items,
            ]; 
            // 白字图片（选中）
            imgUrlArray_white.value = [
                fortune_white,
                work_promotion_white,
                company_development_white,
                investment_white,
                interpersonal_relationships_white,
                helping_others_white,
                emotional_experience_marriage_white,
                who_can_help_white,
                seeking_assistance_white,
                bearing_children_white,
                physical_mental_health_white,
                medical_treatment_white,
                marriage_white,
                official_disputes_white,
                learning_exams_white,
                travel_white,
                vehicle_use_white,
                buying_renting_houses_white,
                ancestral_grave_relocation_white,
                feng_shui_changes_white,
                move_omens_white,
                lost_items_white,
                tattoos_scars_white,
                resignation_white,

                making_new_friends_contacting_old_friends_white,
                unfair_improper_actions_white,
                skill_enhancement_white,
                living_with_others_white,
                family_member_passing_white,
                adopting_abandoning_animals_white,
                losing_people_pets_white,
                weather_impact_on_major_events_white,
                harming_animals_white,
                loss_damage_of_items_white,
            ];
      }

        /**
         *  ！！！ 由于 屏幕变化的时候如果是选中某些选项的，
         *  选项的位置变化会导致样式出以及选中的选项不是原来的选项的bug
         *  暂时的解决办法：在屏幕变化的后每次都会清空选项，以及设置样式为未选中状态。
         */ 
        // 清空各选项相关数组
        names.value = []
        ids.value = []
        paths.value = []
        // 设置所有选项样式为未选中状态
        imgUrlArray.value.forEach((el,idx) => {
            to_blue(idx)
        });
        
        

    };
    resizeSetter() // 初始化时设置一次
    window.addEventListener('resize', resizeSetter) // 监听窗口尺寸变化
    onUnmounted(() => {window.removeEventListener('resize', resizeSetter) }) // 清理窗口尺寸变化事件监听器


        // ******处理paths的规则 l即大屏******
        function arrangeArray_l(arr) {
            if(arr.length !== 0){
                console.log('调整前', arr);
            
                // 预处理数组元素，去掉前缀和后缀
                let prefix = '';
                if (arr[0].includes('font_blue')) {
                    prefix = '/src/assets/image/img/font_blue/recent_luck/'
                } else if (arr[0].includes('font_white')) {
                    prefix = '/src/assets/image/img/font_white/recent_luck/'
                }
                const suffix = '.png';
                const processedArr = arr.map(path => path.replace(prefix, '').replace(suffix, ''));
            
                // 分离数组元素
                let shortWords = [];
                let longWords = [];
            
                for (let word of processedArr) {
                    if (word.length < 8) {
                        shortWords.push(word);
                    } else {
                        longWords.push(word);
                    }
                }
            
                // 桌面端排列逻辑
                let result = [];
            
                // 先处理非八字或以上的字符串，三三排
                while (shortWords.length >= 3) {
                    result = result.concat(shortWords.splice(0, 3));
                }
            
                // 处理八字或以上的字符串
                for (let i = 0; i < longWords.length; i++) {
                    // 如果当前结果数组长度是3的倍数，且还有至少三个长字符串，则添加三个长字符串
                    if (result.length % 3 === 0 && longWords.length - i >= 3) {
                        result = result.concat(longWords.slice(i, i + 3));
                        i += 2; // 跳过已经添加的两个元素
                    } else {
                        // 否则添加一个长字符串
                        result.push(longWords[i]);
                    }
                }
            
                // 添加剩余的非八字或以上的字符串，保持原有顺序
                result = result.concat(shortWords);
            
                // 添加前缀和后缀
                result = result.map((r) => {
                    return prefix + r + suffix;
                });
            
                return result;
            }
        }

        // ******处理paths的规则 sm即小屏和中屏******
        function arrangeArray_sm(arr) {
            if(arr.length !== 0){
                console.log('调整前', arr);
            
                // 预处理数组元素，去掉前缀和后缀
                let prefix = '';
                if (arr[0].includes('font_blue')) {
                    prefix = '/src/assets/image/img/font_blue/recent_luck/';
                } else if (arr[0].includes('font_white')) {
                    prefix = '/src/assets/image/img/font_white/recent_luck/';
                }
                const suffix = '.png';
                const processedArr = arr.map(path => path.replace(prefix, '').replace(suffix, ''));
            
                // 分离数组元素
                let shortWords = [];
                let longWords = [];
            
                for (let word of processedArr) {
                    if (word.length < 8) {
                        shortWords.push(word);
                    } else {
                        longWords.push(word);
                    }
                }
            
                // 桌面端排列逻辑
                let result = [];
            
                // 先处理非八字或以上的字符串，两两排
                while (shortWords.length >= 2) {
                    result = result.concat(shortWords.splice(0, 2));
                }
            
                // 处理八字或以上的字符串
                for (let i = 0; i < longWords.length; i++) {
                    // 如果当前结果数组长度是2的倍数，且还有至少两个长字符串，则添加两个长字符串
                    if (result.length % 2 === 0 && longWords.length - i >= 2) {
                        result = result.concat(longWords.slice(i, i + 2));
                        i += 1; // 跳过已经添加的一个元素
                    } else {
                        // 否则添加一个长字符串
                        result.push(longWords[i]);
                    }
                }
            
                // 添加剩余的非八字或以上的字符串，保持原有顺序
                result = result.concat(shortWords);
            
                // 添加前缀和后缀
                result = result.map((r) => {
                    return prefix + r + suffix;
                });
            
                return result;
            }
        }


        return {
            pageNum,
            imgUrlArray,
            imgUrlArray_backup,
            imgUrlArray_white,
            chooseIcon,
            bgColorItem,
            ids,
            names,
            paths,
            paths_backup,
            paths_white,
            lastSelectedIndex,


            resetChooseIcon,
            idcnMapHandler,
            getSelectedPaths,
            to_blue,
            to_white,
            arrangeArray_l,
            arrangeArray_sm,
        } 
    })